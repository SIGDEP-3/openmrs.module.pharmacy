<?xml version="1.0" encoding="UTF-8"?>
 
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog/1.9"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog/1.9
                  http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-1.9.xsd">
    <!--
        See http://www.liquibase.org/manual/home#available_database_refactorings
        for a list of supported elements and attributes
    -->

    <changeSet id="pharmacy-product-unit" author="BOGUI SERGE">
        <createTable tableName="pharmacy_product_unit">
            <column name="product_unit_id" type="int" autoIncrement="true">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="name" type="varchar(100)">
                <constraints nullable="false" unique="true"/>
            </column>
            <column name="description" type="varchar(255)"/>
            <column name="uuid" type="varchar(38)">
                <constraints nullable="false" unique="true"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="pharmacy-product" author="BOGUI SERGE">
        <createTable tableName="pharmacy_product">
            <column name="product_id" type="int" autoIncrement="true">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="code" type="varchar(255)">
                <constraints nullable="false" unique="true"/>
            </column>
            <column name="retail_name" type="varchar(255)">
                <constraints nullable="false"/>
            </column>
            <column name="wholesale_name" type="varchar(255)">
                <constraints nullable="false"/>
            </column>
            <column name="product_retail_unit" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="product_wholesale_unit" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="unit_conversion" type="int">
                <constraints nullable="false"/>
            </column>

            <column name="uuid" type="varchar(38)">
                <constraints nullable="false" unique="true"/>
            </column>
        </createTable>
        <addForeignKeyConstraint constraintName="pharmacy_product_product_unit_retail"
                                 baseTableName="pharmacy_product" baseColumnNames="product_retail_unit"
                                 referencedTableName="pharmacy_product_unit" referencedColumnNames="product_unit_id"/>
        <addForeignKeyConstraint constraintName="pharmacy_product_product_unit_wholesale"
                                 baseTableName="pharmacy_product" baseColumnNames="product_wholesale_unit"
                                 referencedTableName="pharmacy_product_unit" referencedColumnNames="product_unit_id"/>
    </changeSet>

    <changeSet id="pharmacy-product-program" author="BOGUI SERGE">
        <createTable tableName="pharmacy_product_program">
            <column name="product_program_id" type="int" autoIncrement="true">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="name" type="varchar(255)">
                <constraints nullable="false" unique="true"/>
            </column>
            <column name="description" type="varchar(255)"/>
            <column name="uuid" type="varchar(38)">
                <constraints nullable="false" unique="true"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="pharmacy-product-program-members" author="BOGUI SERGE">
        <createTable tableName="pharmacy_product_program_members">
            <column name="program_id" type="int">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="product_id" type="int">
                <constraints nullable="false" primaryKey="true"/>
            </column>
        </createTable>

        <addForeignKeyConstraint constraintName="pharmacy_product_product_program_members_program"
                                 baseTableName="pharmacy_product_program_members" baseColumnNames="program_id"
                                 referencedTableName="pharmacy_product_program" referencedColumnNames="product_program_id"/>

        <addForeignKeyConstraint constraintName="pharmacy_product_product_program_members_product"
                                 baseTableName="pharmacy_product_program_members" baseColumnNames="product_id"
                                 referencedTableName="pharmacy_product" referencedColumnNames="product_id"/>
    </changeSet>

    <changeSet id="pharmacy-product-price" author="BOGUI SERGE">
        <createTable tableName="pharmacy_product_price">
            <column name="product_price_id" type="int" autoIncrement="true">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="product_id" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="product_program_id" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="sale_price" type="varchar(255)">
                <constraints nullable="false" unique="true"/>
            </column>
            <column name="purchase_price" type="double">
                <constraints nullable="false"/>
            </column>
            <column name="date_created" type="double">
                <constraints nullable="false"/>
            </column>
            <column name="is_active" type="tinyint(1)" defaultValueBoolean="true">
                <constraints nullable="false"/>
            </column>

            <column name="uuid" type="varchar(38)">
                <constraints nullable="false" unique="true"/>
            </column>
        </createTable>
        <addForeignKeyConstraint constraintName="pharmacy_product_price_product"
                                 baseTableName="pharmacy_product_price" baseColumnNames="product_id"
                                 referencedTableName="pharmacy_product" referencedColumnNames="product_id"/>
        <addForeignKeyConstraint constraintName="pharmacy_product_price_program"
                                 baseTableName="pharmacy_product_price" baseColumnNames="product_program_id"
                                 referencedTableName="pharmacy_product_program" referencedColumnNames="product_program_id"/>
    </changeSet>

    <changeSet id="pharmacy-product-regimen" author="BOGUI SERGE">
        <createTable tableName="pharmacy_product_regimen">
            <column name="product_regimen_id" type="int" autoIncrement="true">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="concept_id" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="uuid" type="varchar(38)">
                <constraints nullable="false" unique="true"/>
            </column>
        </createTable>
        <addForeignKeyConstraint constraintName="pharmacy_product_product_regimen_concept"
                                 baseTableName="pharmacy_product_regimen" baseColumnNames="concept_id"
                                 referencedTableName="concept" referencedColumnNames="concept_id"/>
    </changeSet>

    <changeSet id="pharmacy-product-regimen-members" author="BOGUI SERGE">
        <createTable tableName="pharmacy_product_regimen_members">
            <column name="regimen_id" type="int">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="product_id" type="int">
                <constraints nullable="false" primaryKey="true"/>
            </column>
        </createTable>

        <addForeignKeyConstraint constraintName="pharmacy_product_product_regimen_members_regimen"
                                 baseTableName="pharmacy_product_regimen_members" baseColumnNames="regimen_id"
                                 referencedTableName="pharmacy_product_regimen" referencedColumnNames="product_regimen_id"/>

        <addForeignKeyConstraint constraintName="pharmacy_product_product_regimen_members_product"
                                 baseTableName="pharmacy_product_regimen_members" baseColumnNames="product_id"
                                 referencedTableName="pharmacy_product" referencedColumnNames="product_id"/>
    </changeSet>

    <changeSet id="pharmacy-product-supplier" author="BOGUI SERGE">
        <preConditions>
            <not>
                <tableExists tableName="pharmacy_product_supplier"/>
            </not>
        </preConditions>
        <createTable tableName="pharmacy_product_supplier">
            <column name="product_supplier_id" type="int" autoIncrement="true">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="name" type="varchar(100)">
                <constraints nullable="false" unique="true"/>
            </column>
            <column name="short_name" type="varchar(50)"/>
            <column name="phone_number" type="varchar(50)"/>
            <column name="description" type="varchar(255)"/>
            <column name="email" type="varchar(255)"/>
            <column name="location_id" type="int"/>
            <column name="uuid" type="varchar(38)">
                <constraints nullable="false" unique="true"/>
            </column>
        </createTable>
        <addForeignKeyConstraint constraintName="pharmacy_product_supplier_location"
                                 baseTableName="pharmacy_product_supplier" baseColumnNames="location_id"
                                 referencedTableName="location" referencedColumnNames="location_id"/>
    </changeSet>

    <changeSet id="pharmacy-product-attribute" author="BOGUI SERGE">
        <preConditions>
            <not>
                <tableExists tableName="pharmacy_product_attribute"/>
            </not>
        </preConditions>
        <createTable tableName="pharmacy_product_attribute">
            <column name="product_attribute_id" type="int" autoIncrement="true">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="product_id" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="batch_number" type="varchar(100)">
                <constraints nullable="false" unique="true"/>
            </column>
            <column name="expiry_date" type="date"/>
            <column name="location_id" type="int">
                <constraints nullable="false"/>
            </column>

            <column name="uuid" type="varchar(38)">
                <constraints nullable="false" unique="true"/>
            </column>
        </createTable>

        <addForeignKeyConstraint constraintName="pharmacy_product_attribute_product"
                                 baseTableName="pharmacy_product_attribute" baseColumnNames="product_id"
                                 referencedTableName="pharmacy_product" referencedColumnNames="product_id"/>

        <addForeignKeyConstraint constraintName="pharmacy_product_attribute_location"
                                 baseTableName="pharmacy_product_attribute" baseColumnNames="location_id"
                                 referencedTableName="location" referencedColumnNames="location_id"/>
    </changeSet>

    <changeSet id="pharmacy-product-operation" author="BOGUI SERGE">
        <preConditions>
            <not>
                <tableExists tableName="pharmacy_product_operation"/>
            </not>
        </preConditions>
        <createTable tableName="pharmacy_product_operation">
            <column name="product_operation_id" type="int" autoIncrement="true">
                <constraints primaryKey="true"/>
            </column>
            <column name="operation_number" type="varchar(100)"/>
            <column name="program_id" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="operation_date" type="date">
                <constraints nullable="false"/>
            </column>
            <column name="operation_status" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="incidence" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="location_id" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="observation" type="varchar(255)"/>

            <column name="creator" type="int" >
                <constraints nullable="false" />
            </column>
            <column name="date_created" type="datetime" >
                <constraints nullable="false"/>
            </column>
            <column name="changed_by" type="int" />
            <column name="date_changed" type="datetime" />
            <column name="voided" type="tinyint" defaultValueNumeric="0">
                <constraints nullable="false"/>
            </column>
            <column name="voided_by" type="int" />
            <column name="date_voided" type="datetime" />
            <column name="void_reason" type="varchar(255)" defaultValue="null"/>
            <column name="uuid" type="varchar(38)">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <addForeignKeyConstraint constraintName="pharmacy_product_operation_program"
                                 baseTableName="pharmacy_product_operation" baseColumnNames="program_id"
                                 referencedTableName="pharmacy_product_program" referencedColumnNames="product_program_id"/>
        <addForeignKeyConstraint constraintName="pharmacy_product_operation_creator"
                                 baseTableName="pharmacy_product_operation" baseColumnNames="creator"
                                 referencedTableName="users" referencedColumnNames="user_id"/>
        <addForeignKeyConstraint constraintName="pharmacy_product_operation_changed_by"
                                 baseTableName="pharmacy_product_operation" baseColumnNames="changed_by"
                                 referencedTableName="users" referencedColumnNames="user_id"/>
        <addForeignKeyConstraint constraintName="pharmacy_product_operation_voided_by"
                                 baseTableName="pharmacy_product_operation" baseColumnNames="voided_by"
                                 referencedTableName="users" referencedColumnNames="user_id"/>
        <addForeignKeyConstraint constraintName="pharmacy_product_operation_location"
                                 baseTableName="pharmacy_product_operation" baseColumnNames="location_id"
                                 referencedTableName="location" referencedColumnNames="location_id"/>
    </changeSet>

    <changeSet id="pharmacy-product-attribute-flux" author="BOGUI SERGE">
        <preConditions>
            <not>
                <tableExists tableName="pharmacy_product_attribute_flux"/>
            </not>
        </preConditions>
        <createTable tableName="pharmacy_product_attribute_flux">
            <column name="product_attribute_flux_id" type="int" autoIncrement="true">
                <constraints primaryKey="true"/>
            </column>
            <column name="product_attribute_id" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="operation_id" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="quantity" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="operation_date" type="date">
                <constraints nullable="false"/>
            </column>
            <column name="status" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="location_id" type="int">
                <constraints nullable="false"/>
            </column>

            <column name="creator" type="int" >
                <constraints nullable="false" />
            </column>
            <column name="date_created" type="datetime" >
                <constraints nullable="false"/>
            </column>
            <column name="changed_by" type="int" />
            <column name="date_changed" type="datetime" />
            <column name="voided" type="tinyint" defaultValueNumeric="0">
                <constraints nullable="false"/>
            </column>
            <column name="voided_by" type="int" />
            <column name="date_voided" type="datetime" />
            <column name="void_reason" type="varchar(255)" defaultValue="null"/>
            <column name="uuid" type="varchar(38)">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <addForeignKeyConstraint constraintName="pharmacy_product_attribute_flux_product_attribute"
                                 baseTableName="pharmacy_product_attribute_flux" baseColumnNames="product_attribute_id"
                                 referencedTableName="pharmacy_product_attribute" referencedColumnNames="product_attribute_id"/>
        <addForeignKeyConstraint constraintName="pharmacy_product_attribute_flux_product_operation"
                                 baseTableName="pharmacy_product_attribute_flux" baseColumnNames="operation_id"
                                 referencedTableName="pharmacy_product_operation" referencedColumnNames="product_operation_id"/>
        <addForeignKeyConstraint constraintName="pharmacy_product_attribute_flux_creator"
                                 baseTableName="pharmacy_product_attribute_flux" baseColumnNames="creator"
                                 referencedTableName="users" referencedColumnNames="user_id"/>
        <addForeignKeyConstraint constraintName="pharmacy_product_attribute_flux_changed_by"
                                 baseTableName="pharmacy_product_attribute_flux" baseColumnNames="changed_by"
                                 referencedTableName="users" referencedColumnNames="user_id"/>
        <addForeignKeyConstraint constraintName="pharmacy_product_attribute_flux_voided_by"
                                 baseTableName="pharmacy_product_attribute_flux" baseColumnNames="voided_by"
                                 referencedTableName="users" referencedColumnNames="user_id"/>
        <addForeignKeyConstraint constraintName="pharmacy_product_attribute_flux_location"
                                 baseTableName="pharmacy_product_attribute_flux" baseColumnNames="location_id"
                                 referencedTableName="location" referencedColumnNames="location_id"/>
    </changeSet>

    <changeSet id="pharmacy-product-attribute-other-flux" author="BOGUI SERGE">
        <preConditions>
            <not>
                <tableExists tableName="pharmacy_product_attribute_other_flux"/>
            </not>
        </preConditions>
        <createTable tableName="pharmacy_product_attribute_other_flux">
            <column name="product_attribute_other_flux_id" type="int" autoIncrement="true">
                <constraints primaryKey="true"/>
            </column>
            <column name="product_attribute_id" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="operation_id" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="quantity" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="location_id" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="uuid" type="varchar(38)">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <addForeignKeyConstraint constraintName="pharmacy_product_attribute_other_flux_product_attribute"
                                 baseTableName="pharmacy_product_attribute_other_flux" baseColumnNames="product_attribute_id"
                                 referencedTableName="pharmacy_product_attribute" referencedColumnNames="product_attribute_id"/>
        <addForeignKeyConstraint constraintName="pharmacy_product_attribute_other_flux_product_operation"
                                 baseTableName="pharmacy_product_attribute_other_flux" baseColumnNames="operation_id"
                                 referencedTableName="pharmacy_product_operation" referencedColumnNames="product_operation_id"/>
        <addForeignKeyConstraint constraintName="pharmacy_product_attribute_other_flux_location"
                                 baseTableName="pharmacy_product_attribute_other_flux" baseColumnNames="location_id"
                                 referencedTableName="location" referencedColumnNames="location_id"/>
    </changeSet>

    <changeSet id="pharmacy-product-reception" author="BOGUI SERGE">
        <preConditions>
            <not>
                <tableExists tableName="pharmacy_product_reception"/>
            </not>
        </preConditions>
        <createTable tableName="pharmacy_product_reception">
            <column name="product_operation_id" type="int">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="product_supplier_id" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="reception_mode" type="int">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <addForeignKeyConstraint constraintName="pharmacy_product_reception_product_operation"
                                 baseTableName="pharmacy_product_reception" baseColumnNames="product_operation_id"
                                 referencedTableName="pharmacy_product_operation" referencedColumnNames="product_operation_id"/>
        <addForeignKeyConstraint constraintName="pharmacy_product_reception_product_supplier"
                                 baseTableName="pharmacy_product_reception" baseColumnNames="product_supplier_id"
                                 referencedTableName="pharmacy_product_supplier" referencedColumnNames="product_supplier_id"/>
    </changeSet>

    <changeSet id="pharmacy-product-inventory" author="BOGUI SERGE">
        <preConditions>
            <not>
                <tableExists tableName="pharmacy_product_inventory"/>
            </not>
        </preConditions>
        <createTable tableName="pharmacy_product_inventory">
            <column name="product_operation_id" type="int">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="inventory_date" type="date">
                <constraints nullable="false"/>
            </column>
            <column name="inventory_start_date" type="date">
                <constraints nullable="false"/>
            </column>
            <column name="inventory_end_date" type="date">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <addForeignKeyConstraint constraintName="pharmacy_product_inventory_product_operation"
                                 baseTableName="pharmacy_product_inventory" baseColumnNames="product_operation_id"
                                 referencedTableName="pharmacy_product_operation" referencedColumnNames="product_operation_id"/>

    </changeSet>

    <changeSet id="pharmacy-product-dispensing" author="BOGUI SERGE">
        <preConditions>
            <not>
                <tableExists tableName="pharmacy_product_dispensing"/>
            </not>
        </preConditions>
        <createTable tableName="pharmacy_product_dispensing">
            <column name="product_operation_id" type="int">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="regimen_id" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="prescription_date" type="date">
                <constraints nullable="false"/>
            </column>
            <column name="treatment_days" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="patient_id" type="int"/>
        </createTable>
        <addForeignKeyConstraint constraintName="pharmacy_product_dispensing_product_operation"
                                 baseTableName="pharmacy_product_dispensing" baseColumnNames="product_operation_id"
                                 referencedTableName="pharmacy_product_operation" referencedColumnNames="product_operation_id"/>
        <addForeignKeyConstraint constraintName="pharmacy_product_dispensing_product_regimen"
                                 baseTableName="pharmacy_product_dispensing" baseColumnNames="regimen_id"
                                 referencedTableName="pharmacy_product_regimen" referencedColumnNames="product_regimen_id"/>
        <addForeignKeyConstraint constraintName="pharmacy_product_dispensing_patient"
                                 baseTableName="pharmacy_product_dispensing" baseColumnNames="patient_id"
                                 referencedTableName="patient" referencedColumnNames="patient_id"/>
    </changeSet>

    <changeSet id="pharmacy-mobile-patient" author="BOGUI SERGE">
        <preConditions>
            <not>
                <tableExists tableName="pharmacy_mobile_patient"/>
            </not>
        </preConditions>
        <createTable tableName="pharmacy_mobile_patient">
            <column name="mobile_patient_id" type="int" autoIncrement="true">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="age" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="identifier" type="varchar(100)"/>
            <column name="gender" type="varchar(5)"/>
            <column name="location_id" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="uuid" type="varchar(38)">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <addForeignKeyConstraint constraintName="pharmacy_mobile_patient_location"
                                 baseTableName="pharmacy_mobile_patient" baseColumnNames="location_id"
                                 referencedTableName="location" referencedColumnNames="location_id"/>
    </changeSet>

    <changeSet id="pharmacy-mobile-patient-product-dispensing-members" author="BOGUI SERGE">
        <createTable tableName="pharmacy_mobile_patient_product_dispensing_members">
            <column name="product_dispensing_id" type="int">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="mobile_patient_id" type="int">
                <constraints nullable="false" primaryKey="true"/>
            </column>
        </createTable>

        <addForeignKeyConstraint constraintName="pharmacy_mobile_patient_product_dispensing_members_dispensing"
                                 baseTableName="pharmacy_mobile_patient_product_dispensing_members"
                                 baseColumnNames="product_dispensing_id"
                                 referencedTableName="pharmacy_product_dispensing" referencedColumnNames="product_operation_id"/>

        <addForeignKeyConstraint constraintName="pharmacy_mobile_patient_product_dispensing_mobile_patient"
                                 baseTableName="pharmacy_mobile_patient_product_dispensing_members"
                                 baseColumnNames="mobile_patient_id"
                                 referencedTableName="pharmacy_mobile_patient" referencedColumnNames="mobile_patient_id"/>
    </changeSet>

    <changeSet id="pharmacy-product-exchange-entity" author="BOGUI SERGE">
        <preConditions>
            <not>
                <tableExists tableName="pharmacy_product_exchange_entity"/>
            </not>
        </preConditions>
        <createTable tableName="pharmacy_product_exchange_entity">
            <column name="product_exchange_entity_id" type="int" autoIncrement="true">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="name" type="varchar(100)">
                <constraints nullable="false" unique="true"/>
            </column>
            <column name="description" type="varchar(255)"/>
            <column name="location_id" type="int"/>
            <column name="uuid" type="varchar(38)">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <addForeignKeyConstraint constraintName="pharmacy_product_exchange_entity_location"
                                 baseTableName="pharmacy_product_exchange_entity" baseColumnNames="location_id"
                                 referencedTableName="location" referencedColumnNames="location_id"/>
    </changeSet>

    <changeSet id="pharmacy-product-movement-entry" author="BOGUI SERGE">
        <preConditions>
            <not>
                <tableExists tableName="pharmacy_product_movement_entry"/>
            </not>
        </preConditions>
        <createTable tableName="pharmacy_product_movement_entry">
            <column name="product_operation_id" type="int">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="sender" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="stock_entry_type" type="int">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <addForeignKeyConstraint constraintName="pharmacy_product_movement_entry_operation"
                                 baseTableName="pharmacy_product_movement_entry" baseColumnNames="product_operation_id"
                                 referencedTableName="pharmacy_product_operation" referencedColumnNames="product_operation_id"/>
        <addForeignKeyConstraint constraintName="pharmacy_product_movement_entry_sender"
                                 baseTableName="pharmacy_product_movement_entry" baseColumnNames="sender"
                                 referencedTableName="pharmacy_product_exchange_entity" referencedColumnNames="product_exchange_entity_id"/>

    </changeSet>

    <changeSet id="pharmacy-product-movement-out" author="BOGUI SERGE">
        <preConditions>
            <not>
                <tableExists tableName="pharmacy_product_movement_out"/>
            </not>
        </preConditions>

        <createTable tableName="pharmacy_product_movement_out">
            <column name="product_operation_id" type="int">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="recipient" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="stock_out_type" type="int">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <addForeignKeyConstraint constraintName="pharmacy_product_movement_out_operation"
                                 baseTableName="pharmacy_product_movement_out" baseColumnNames="product_operation_id"
                                 referencedTableName="pharmacy_product_operation" referencedColumnNames="product_operation_id"/>
        <addForeignKeyConstraint constraintName="pharmacy_product_movement_out_recipient"
                                 baseTableName="pharmacy_product_movement_out" baseColumnNames="recipient"
                                 referencedTableName="pharmacy_product_exchange_entity" referencedColumnNames="product_exchange_entity_id"/>

    </changeSet>

    <changeSet id="pharmacy-product-attribute-stock" author="BOGUI SERGE">
        <preConditions>
            <not>
                <tableExists tableName="pharmacy_product_attribute_stock"/>
            </not>
        </preConditions>
        <createTable tableName="pharmacy_product_attribute_stock">
            <column name="product_attribute_stock_id" type="int" autoIncrement="true">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="product_attribute_id" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="quantity_in_stock" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="date_created" type="date"/>
            <column name="location_id" type="int">
                <constraints nullable="false"/>
            </column>

            <column name="uuid" type="varchar(38)">
                <constraints nullable="false" unique="true"/>
            </column>
        </createTable>

        <addForeignKeyConstraint constraintName="pharmacy_product_attribute_stock_product_attribute"
                                 baseTableName="pharmacy_product_attribute_stock" baseColumnNames="product_attribute_id"
                                 referencedTableName="pharmacy_product_attribute" referencedColumnNames="product_attribute_id"/>

        <addForeignKeyConstraint constraintName="pharmacy_product_attribute_stock_location"
                                 baseTableName="pharmacy_product_attribute_stock" baseColumnNames="location_id"
                                 referencedTableName="location" referencedColumnNames="location_id"/>
    </changeSet>
    <changeSet id="add-encounter-type-dispensing" author="BOGUI SERGE">
        <preConditions>
            <sqlCheck expectedResult="0">SELECT COUNT(*) FROM encounter_type WHERE name = 'DISPENSATION'</sqlCheck>
        </preConditions>
        <sql>
            INSERT INTO encounter_type (encounter_type_id, name, description, creator, date_created, retired, uuid)
            VALUE (17, 'DISPENSATION', NULL, 1, '2020-11-10', 0, 'cfb217pd-4af2-40f4-9d6e-0d1b38d2af86');
        </sql>
    </changeSet>

    <changeSet id="insert-pharmacy-program-data" author="BOGUI SERGE">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">SELECT COUNT(*) FROM pharmacy_product_program</sqlCheck>
        </preConditions>
        <sql>
            INSERT INTO pharmacy_product_program (product_program_id, name, description, uuid) VALUES (1, 'PNLSARVIO', null, '44ac1b52-2691-11eb-ae9e-0242ac1a0002');
            INSERT INTO pharmacy_product_program (product_program_id, name, description, uuid) VALUES (2, 'PNLSLAB', null, '44ac98f8-2691-11eb-ae9e-0242ac1a0002');
            INSERT INTO pharmacy_product_program (product_program_id, name, description, uuid) VALUES (3, 'ME_REC', null, '44ac9d75-2691-11eb-ae9e-0242ac1a0002');
            INSERT INTO pharmacy_product_program (product_program_id, name, description, uuid) VALUES (4, 'GTC', null, '44ac9e02-2691-11eb-ae9e-0242ac1a0002');
            INSERT INTO pharmacy_product_program (product_program_id, name, description, uuid) VALUES (5, 'PNSME', null, '44ac9e6c-2691-11eb-ae9e-0242ac1a0002');
            INSERT INTO pharmacy_product_program (product_program_id, name, description, uuid) VALUES (6, 'PNLT', null, '44ac9ecd-2691-11eb-ae9e-0242ac1a0002');
            INSERT INTO pharmacy_product_program (product_program_id, name, description, uuid) VALUES (7, 'PNLP', null, '44ac9f24-2691-11eb-ae9e-0242ac1a0002');
            INSERT INTO pharmacy_product_program (product_program_id, name, description, uuid) VALUES (8, 'CONSO', null, '44ac9f79-2691-11eb-ae9e-0242ac1a0002');
            INSERT INTO pharmacy_product_program (product_program_id, name, description, uuid) VALUES (9, 'PNLSTRC', null, '44aca368-2691-11eb-ae9e-0242ac1a0002');
        </sql>
    </changeSet>

    <changeSet id="insert-pharmacy-unit-data" author="BOGUI SERGE">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">SELECT COUNT(*) FROM pharmacy_product_unit</sqlCheck>
        </preConditions>
        <sql>
            INSERT INTO pharmacy_product_unit (product_unit_id, name, description, uuid) VALUES (1, 'AIGUILLE', null, '5764bf2b-2693-11eb-ae9e-0242ac1a0002');
            INSERT INTO pharmacy_product_unit (product_unit_id, name, description, uuid) VALUES (2, 'AMPOULE', null, '5763fc7b-2693-11eb-ae9e-0242ac1a0002');
            INSERT INTO pharmacy_product_unit (product_unit_id, name, description, uuid) VALUES (3, 'BALLE', null, '57655045-2693-11eb-ae9e-0242ac1a0002');
            INSERT INTO pharmacy_product_unit (product_unit_id, name, description, uuid) VALUES (4, 'BANDE', null, '5764bea8-2693-11eb-ae9e-0242ac1a0002');
            INSERT INTO pharmacy_product_unit (product_unit_id, name, description, uuid) VALUES (5, 'BIDON', null, '57644fde-2693-11eb-ae9e-0242ac1a0002');
            INSERT INTO pharmacy_product_unit (product_unit_id, name, description, uuid) VALUES (6, 'BOITE', null, '5763fd30-2693-11eb-ae9e-0242ac1a0002');
            INSERT INTO pharmacy_product_unit (product_unit_id, name, description, uuid) VALUES (7, 'CAPSULE', null, '57640088-2693-11eb-ae9e-0242ac1a0002');
            INSERT INTO pharmacy_product_unit (product_unit_id, name, description, uuid) VALUES (8, 'CARTON', null, '57655c3e-2693-11eb-ae9e-0242ac1a0002');
            INSERT INTO pharmacy_product_unit (product_unit_id, name, description, uuid) VALUES (9, 'CASSET', null, '57656917-2693-11eb-ae9e-0242ac1a0002');
            INSERT INTO pharmacy_product_unit (product_unit_id, name, description, uuid) VALUES (10, 'CASSETTE', null, '5764a441-2693-11eb-ae9e-0242ac1a0002');
            INSERT INTO pharmacy_product_unit (product_unit_id, name, description, uuid) VALUES (11, 'COMPRIME', null, '5763fcb3-2693-11eb-ae9e-0242ac1a0002');
            INSERT INTO pharmacy_product_unit (product_unit_id, name, description, uuid) VALUES (12, 'CORPS', null, '5764bf5f-2693-11eb-ae9e-0242ac1a0002');
            INSERT INTO pharmacy_product_unit (product_unit_id, name, description, uuid) VALUES (13, 'CRYOTUBE', null, '5764b1f5-2693-11eb-ae9e-0242ac1a0002');
            INSERT INTO pharmacy_product_unit (product_unit_id, name, description, uuid) VALUES (14, 'CUPS', null, '5764b13d-2693-11eb-ae9e-0242ac1a0002');
            INSERT INTO pharmacy_product_unit (product_unit_id, name, description, uuid) VALUES (15, 'CUPULE', null, '5764a080-2693-11eb-ae9e-0242ac1a0002');
            INSERT INTO pharmacy_product_unit (product_unit_id, name, description, uuid) VALUES (16, 'CUVETTE', null, '5764a427-2693-11eb-ae9e-0242ac1a0002');
            INSERT INTO pharmacy_product_unit (product_unit_id, name, description, uuid) VALUES (17, 'EMBOUT', null, '5764b1c0-2693-11eb-ae9e-0242ac1a0002');
            INSERT INTO pharmacy_product_unit (product_unit_id, name, description, uuid) VALUES (18, 'FIL', null, '5764509c-2693-11eb-ae9e-0242ac1a0002');
            INSERT INTO pharmacy_product_unit (product_unit_id, name, description, uuid) VALUES (19, 'FL', null, '57640edc-2693-11eb-ae9e-0242ac1a0002');
            INSERT INTO pharmacy_product_unit (product_unit_id, name, description, uuid) VALUES (20, 'FLACON', null, '5763fc2e-2693-11eb-ae9e-0242ac1a0002');
            INSERT INTO pharmacy_product_unit (product_unit_id, name, description, uuid) VALUES (21, 'GELULE', null, '5764040f-2693-11eb-ae9e-0242ac1a0002');
            INSERT INTO pharmacy_product_unit (product_unit_id, name, description, uuid) VALUES (22, 'KIT', null, '5763fba9-2693-11eb-ae9e-0242ac1a0002');
            INSERT INTO pharmacy_product_unit (product_unit_id, name, description, uuid) VALUES (23, 'LANCETTE', null, '5764bd30-2693-11eb-ae9e-0242ac1a0002');
            INSERT INTO pharmacy_product_unit (product_unit_id, name, description, uuid) VALUES (24, 'MICROTUBE', null, '5764b624-2693-11eb-ae9e-0242ac1a0002');
            INSERT INTO pharmacy_product_unit (product_unit_id, name, description, uuid) VALUES (25, 'OVULE', null, '57640bf5-2693-11eb-ae9e-0242ac1a0002');
            INSERT INTO pharmacy_product_unit (product_unit_id, name, description, uuid) VALUES (26, 'PAIRE', null, '5764581e-2693-11eb-ae9e-0242ac1a0002');
            INSERT INTO pharmacy_product_unit (product_unit_id, name, description, uuid) VALUES (27, 'PAQUET', null, '57644366-2693-11eb-ae9e-0242ac1a0002');
            INSERT INTO pharmacy_product_unit (product_unit_id, name, description, uuid) VALUES (28, 'PASTILLE', null, '5764c02e-2693-11eb-ae9e-0242ac1a0002');
            INSERT INTO pharmacy_product_unit (product_unit_id, name, description, uuid) VALUES (29, 'PIECE', null, '5764b6d8-2693-11eb-ae9e-0242ac1a0002');
            INSERT INTO pharmacy_product_unit (product_unit_id, name, description, uuid) VALUES (30, 'PLAQUETTE', null, '576487ac-2693-11eb-ae9e-0242ac1a0002');
            INSERT INTO pharmacy_product_unit (product_unit_id, name, description, uuid) VALUES (31, 'POCHE', null, '57643b53-2693-11eb-ae9e-0242ac1a0002');
            INSERT INTO pharmacy_product_unit (product_unit_id, name, description, uuid) VALUES (32, 'POT', null, '576418e5-2693-11eb-ae9e-0242ac1a0002');
            INSERT INTO pharmacy_product_unit (product_unit_id, name, description, uuid) VALUES (33, 'RACK', null, '5764bc7f-2693-11eb-ae9e-0242ac1a0002');
            INSERT INTO pharmacy_product_unit (product_unit_id, name, description, uuid) VALUES (34, 'ROUL', null, '57650319-2693-11eb-ae9e-0242ac1a0002');
            INSERT INTO pharmacy_product_unit (product_unit_id, name, description, uuid) VALUES (35, 'ROULEAU', null, '5764429a-2693-11eb-ae9e-0242ac1a0002');
            INSERT INTO pharmacy_product_unit (product_unit_id, name, description, uuid) VALUES (36, 'SAC', null, '5764b6fc-2693-11eb-ae9e-0242ac1a0002');
            INSERT INTO pharmacy_product_unit (product_unit_id, name, description, uuid) VALUES (37, 'SACHET', null, '5763fe70-2693-11eb-ae9e-0242ac1a0002');
            INSERT INTO pharmacy_product_unit (product_unit_id, name, description, uuid) VALUES (38, 'SEGMENT', null, '5764a0de-2693-11eb-ae9e-0242ac1a0002');
            INSERT INTO pharmacy_product_unit (product_unit_id, name, description, uuid) VALUES (39, 'SERINGUE', null, '576497cf-2693-11eb-ae9e-0242ac1a0002');
            INSERT INTO pharmacy_product_unit (product_unit_id, name, description, uuid) VALUES (40, 'SUPPOSITOIRE', null, '57641f48-2693-11eb-ae9e-0242ac1a0002');
            INSERT INTO pharmacy_product_unit (product_unit_id, name, description, uuid) VALUES (41, 'TEST', null, '57648bba-2693-11eb-ae9e-0242ac1a0002');
            INSERT INTO pharmacy_product_unit (product_unit_id, name, description, uuid) VALUES (42, 'TUBE', null, '57645693-2693-11eb-ae9e-0242ac1a0002');
            INSERT INTO pharmacy_product_unit (product_unit_id, name, description, uuid) VALUES (43, 'UNITE', null, '5763ff79-2693-11eb-ae9e-0242ac1a0002');
        </sql>
    </changeSet>

    <changeSet id="insert-pharmacy-supplier" author="BOGUI SERGE">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">SELECT COUNT(*) FROM pharmacy_product_supplier</sqlCheck>
        </preConditions>
        <sql>
            INSERT INTO pharmacy_product_supplier (name, short_name, phone_number, description, email, location_id, uuid)
            VALUE ('NOUVELLE PHARMACIE DE LA SANTE PUBLIQUE', 'NPSP', NULL, NULL, NULL, NULL, uuid());
        </sql>
    </changeSet>

    <changeSet id="pharmacy-add-column-observation-flux" author="BOGUI SERGE">
        <preConditions>
            <not>
                <columnExists tableName="pharmacy_product_attribute_flux" columnName="observation"/>
            </not>
        </preConditions>
        <addColumn tableName="pharmacy_product_attribute_flux">
            <column name="observation" type="varchar(255)"/>
        </addColumn>
    </changeSet>

    <changeSet id="pharmacy-drop-index-patient-dispensing" author="BOGUI SERGE">
        <preConditions onFail="MARK_RAN">
            <foreignKeyConstraintExists foreignKeyName="pharmacy_product_dispensing_patient"/>
        </preConditions>
        <dropForeignKeyConstraint baseTableName="pharmacy_product_dispensing" constraintName="pharmacy_product_dispensing_patient"/>
    </changeSet>

    <changeSet id="pharmacy-remove-patient-id-dispensing" author="BOGUI SERGE">
        <preConditions onFail="MARK_RAN">
            <columnExists tableName="pharmacy_product_dispensing" columnName="patient_id"/>
        </preConditions>
        <dropColumn tableName="pharmacy_product_dispensing" columnName="patient_id"/>
        <addColumn tableName="pharmacy_product_dispensing">
            <column name="encounter_id" type="int"/>
        </addColumn>
        <addForeignKeyConstraint constraintName="pharmacy_product_dispensing_encounter"
                                 baseTableName="pharmacy_product_dispensing" baseColumnNames="encounter_id"
                                 referencedTableName="encounter" referencedColumnNames="encounter_id"/>
    </changeSet>

<!--    <changeSet id="pharmacy-remove-foreign-key-other-flux" author="BOGUI SERGE">-->
<!--        <preConditions onFail="MARK_RAN">-->
<!--            <foreignKeyConstraintExists foreignKeyName="pharmacy_product_attribute_other_flux_product_attribute"/>-->
<!--        </preConditions>-->
<!--        <dropForeignKeyConstraint baseTableName="pharmacy_product_attribute_other_flux" constraintName="pharmacy_product_attribute_other_flux_product_attribute"/>-->
<!--        <dropForeignKeyConstraint baseTableName="pharmacy_product_attribute_other_flux" constraintName="pharmacy_product_attribute_other_flux_product_operation"/>-->
<!--        <dropColumn tableName="pharmacy_product_attribute_other_flux" columnName="product_attribute_id"/>-->
<!--        <dropColumn tableName="pharmacy_product_attribute_other_flux" columnName="operation_id"/>-->
<!--    </changeSet>-->

    <changeSet id="pharmacy-add-column-attribute-flux-to-other-flux" author="BOGUI SERGE">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="pharmacy_product_attribute_other_flux" columnName="label"/>
            </not>
        </preConditions>
        <addColumn tableName="pharmacy_product_attribute_other_flux">
            <column name="label" type="varchar(100)">
                <constraints nullable="false"/>
            </column>
        </addColumn>
<!--        <addForeignKeyConstraint constraintName="pharmacy_product_attribute_other_flux_product_attribute_flux"-->
<!--                                 baseTableName="pharmacy_product_attribute_other_flux" baseColumnNames="product_attribute_flux_id"-->
<!--                                 referencedTableName="pharmacy_product_attribute_flux" referencedColumnNames="product_attribute_flux_id"/>-->
    </changeSet>

    <changeSet id="change-pharmacy-price-column-date-created" author="BOGUI SERGE">
        <modifyColumn tableName="pharmacy_product_price">
            <column name="date_created" type="date">
                <constraints nullable="false"/>
            </column>
        </modifyColumn>
        <modifyColumn tableName="pharmacy_product_price">
            <column name="sale_price" type="double">
                <constraints nullable="false"/>
            </column>
        </modifyColumn>
    </changeSet>

    <changeSet id="pharmacy-remove-constraint-sale-price-price" author="BOGUI SERGE">
        <dropUniqueConstraint tableName="pharmacy_product_price"
                              constraintName="sale_price"/>
    </changeSet>
    
</databaseChangeLog>
